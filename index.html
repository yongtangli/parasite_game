<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="description" content="Parasite Game">
    <meta name="keywords" content="parasites">
    <link rel="icon" href="icon.png" type="image/png">
    <script type="text/JavaScript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-csv/1.0.21/jquery.csv.js"></script>
    <title>Parasite Quiz</title>
    <!-- Using a simple sans-serif font stack -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
                @font-face {
            font-family: 'Germgoth';
            src: url('fonts/Germgoth.woff') format('woff');
            font-weight: normal;
            font-style: normal;
            font-display: swap;
        }

        /* --- Refined Styles for Sophistication & Elegance --- */

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            /* Using Cormorant Garamond for headings and Inter for body */
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            text-rendering: optimizeLegibility;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            background-color: #F9F7F3; /* Elegant warm off-white */
            color: #404040; /* Dark gray for text */
        }

        /* Title Styling with Germgoth */
        .flashcard-title, .start-title {
            font-family: "Germgoth", serif; /* Using the provided gothic font */
            color: #383838; /* Slightly darker heading color */
            font-weight: normal; /* Germgoth might only have one weight */
            letter-spacing: 0.5px; /* Subtle spacing */
            text-align: center;
            padding-bottom: 5px; /* Space below title */
            /* Removed text-shadow for cleaner look */
        }

        .start-title {
            font-size: 2.8rem; /* Larger start title */
            margin-bottom: 40px; /* More space below */
        }

        .flashcard-title {
            font-size: 1.8rem; /* Slightly larger in-game title */
            margin-bottom: 15px; /* Adjusted space */
        }

        /* Start screen styles */
        .start-screen {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 20px;
            opacity: 0;
            animation: fadeIn 0.8s ease-out forwards; /* Fade in start screen */
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .start-button {
            padding: 14px 35px; /* Generous padding */
            font-size: 1.1rem;
            font-weight: 500;
            background-color: #6D8A96; /* Muted Blue-Gray */
            color: #ffffff;
            border: none;
            border-radius: 8px; /* Consistent radius */
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .start-button:hover {
            background-color: #5A7580; /* Darker shade */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px); /* Subtle lift */
        }

        .start-button:active {
            transform: translateY(0);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .footer {
            position: absolute;
            bottom: 15px; /* Slightly higher */
            width: 100%;
            text-align: center;
            font-size: 0.85rem; /* Smaller font */
            color: #999; /* Lighter gray */
        }

        .footer a {
            color: #888; /* Slightly darker link */
            text-decoration: none;
            transition: color 0.3s ease;
        }

        .footer a:hover {
            color: #6D8A96; /* Accent color on hover */
            text-decoration: none; /* Keep no underline */
        }

        /* Game Screen */
        .flashcard-container {
            width: 100%;
            height: 100%;
            display: none; /* Hidden initially */
            flex-direction: column;
            background-color: #F9F7F3; /* Match body background */
            padding: 25px; /* Slightly more padding */
            position: relative;
            max-width: 1400px; /* Slightly narrower max width */
            margin: 0 auto; /* Center container */
            opacity: 0;
            animation: fadeIn 0.6s 0.2s ease-out forwards; /* Delayed fade in */
        }

        /* Progress Bar Area */
        .progress {
            display: flex;
            justify-content: space-between;
            margin-bottom: 18px; /* More space below */
            gap: 15px;
        }

        .progress-item {
            display: flex;
            align-items: center;
            padding: 8px 15px; /* Adjusted padding */
            border-radius: 20px; /* More rounded */
            font-size: 0.95rem;
            font-weight: 500;
            background-color: transparent; /* No background */
            color: #666; /* Muted text color */
            cursor: pointer;
            transition: color 0.3s ease, transform 0.2s ease;
            border: 1px solid #E0E0E0; /* Subtle border */
        }

        .progress-item:hover {
            background-color: #FFFFFF; /* White background on hover */
            border-color: #D0D0D0;
            transform: scale(1.03); /* Slight scale effect */
        }

        .progress-number-orange {
            margin-right: 8px;
            color: #D98C60; /* Muted Orange */
            font-weight: 600;
            font-size: 1rem;
        }

        .progress-number-green {
            margin-left: 8px;
            color: #79A88F; /* Muted Green */
            font-weight: 600;
            font-size: 1rem;
        }

        /* Image Area */
        .card-content {
            position: relative;
            flex-grow: 1;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            margin-bottom: 20px; /* Adjusted space */
            border-radius: 10px; /* Slightly larger radius */
            background-color: #FFFFFF; /* White background for card */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.07); /* Soft shadow */
            border: 1px solid #EAEAEA; /* Very light border */
        }

        .loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.9); /* Semi-transparent white */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2;
            border-radius: 10px; /* Match parent */
            transition: opacity 0.3s ease-out;
        }

        .spinner {
            border: 4px solid #E0E0E0;
            border-top: 4px solid #6D8A96; /* Accent color spinner */
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1.2s cubic-bezier(0.5, 0, 0.5, 1) infinite; /* Smoother spin */
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .card-content img {
            display: block;
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            transition: opacity 0.5s ease-in-out;
            opacity: 0;
            border-radius: 10px; /* Match container */
        }

        .card-content img.loaded {
            opacity: 1;
        }

        /* Answer Area */
        .your-answer-label {
            font-size: 0.8rem; /* Smaller label */
            font-weight: 500;
            color: #888; /* Lighter gray */
            margin-bottom: 6px;
            text-transform: uppercase; /* Uppercase for style */
            letter-spacing: 0.5px;
            padding-left: 5px;
            transition: visibility 0s linear 0.3s, opacity 0.3s ease; /* Delay visibility change */
        }

        .answer-input-container {
            margin-bottom: 20px; /* More space below input */
            transition: visibility 0s linear 0.3s, opacity 0.3s ease; /* Delay visibility change */
        }

        .answer-input {
            width: 100%;
            padding: 14px 18px; /* More padding */
            font-size: 1.05rem; /* Slightly larger text */
            border: 1px solid #D8D8D8; /* Lighter border */
            border-radius: 8px;
            background-color: #FFFFFF; /* White background */
            color: #404040; /* Dark gray text */
            outline: none;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            appearance: none; /* Remove default styles */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05) inset; /* Subtle inner shadow */
        }

        .answer-input::placeholder {
            color: #B0B0B0; /* Lighter placeholder */
            font-weight: 400;
        }

        .answer-input:focus {
            border-color: #6D8A96; /* Accent color border */
            box-shadow: 0 0 0 3px rgba(109, 138, 150, 0.15), 0 1px 3px rgba(0, 0, 0, 0.05) inset; /* Focus ring + inner shadow */
        }

        /* Bottom Buttons Area */
        .bottom-buttons {
            display: flex;
            justify-content: space-between; /* Space between Don't Know and Answer */
            align-items: center;
            gap: 12px;
            transition: visibility 0s linear 0.3s, opacity 0.3s ease; /* Delay visibility change */
        }

        .dont-know-button, .answer-button {
            padding: 12px 24px; /* Adjusted padding */
            font-size: 1rem;
            font-weight: 500;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
        }

        .dont-know-button {
            background-color: transparent;
            color: #6D8A96; /* Accent color */
            border: 1px solid transparent; /* Placeholder for smooth transition */
        }

        .dont-know-button:hover {
            color: #5A7580; /* Darker accent */
            background-color: rgba(109, 138, 150, 0.08); /* Very subtle background */
            transform: scale(1.02); /* Slight scale */
        }

        .answer-button {
            background-color: #6D8A96; /* Muted Blue-Gray */
            color: #ffffff;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .answer-button:hover {
            background-color: #5A7580; /* Darker shade */
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px); /* Subtle lift */
        }

        .dont-know-button:active, .answer-button:active {
            transform: scale(0.98); /* Keep slight scale down */
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        /* Answer Display Area */
        .card-answer {
            display: none; /* Initially hidden */
            position: absolute;
            /* Position it over the input/button area */
            bottom: 25px; /* Match container padding */
            left: 25px;
            right: 25px;
            background-color: rgba(249, 247, 243, 0.85); /* Semi-transparent background matching page */
            backdrop-filter: blur(8px); /* Frosted glass effect */
            -webkit-backdrop-filter: blur(8px); /* Safari support */
            padding: 20px;
            border-radius: 10px;
            border: none; /* Delete border */
            font-size: 1.05rem; /* Match input text size */
            z-index: 3;
            flex-direction: column;
            gap: 12px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            opacity: 0;
            transform: translateY(10px);
            animation: fadeSlideIn 0.4s ease-out forwards;
            color: #404040; /* Ensure text readability */
            text-align: center;
        }

        @keyframes fadeSlideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        #showAnswer strong { /* Style Correct/Incorrect/Answer labels */
             font-weight: 600;
             margin-right: 5px;
        }
        #showAnswer strong[style*="#10B981"] { color: #60A77C !important; } /* Muted Green */
        #showAnswer strong[style*="#EF4444"] { color: #C76D6D !important; } /* Muted Red */
        #showAnswer strong[style*="#F59E0B"] { color: #C9875A !important; } /* Muted Orange */


        #showExplanation {
            font-size: 0.9rem;
            color: #555;
            line-height: 1.5;
            margin-top: 5px;
            max-height: 100px; /* Limit height if needed */
            overflow-y: auto; /* Add scroll if explanation is long */
        }
         #showExplanation strong {
            font-weight: 600;
            color: #404040;
         }

        /* Next Button */
        .next-button {
            display: block;
            padding: 10px 22px;
            font-size: 1rem; /* Slightly smaller than main button */
            font-weight: 500;
            background-color: transparent;
            color: #6D8A96; /* Accent color */
            border: 1px solid #B0C0C8; /* Border matching accent */
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            align-self: center; /* Center the button */
            margin-top: 15px; /* Space above button */
            /* Remove flashy effects */
        }

        .next-button:hover {
            background-color: #6D8A96;
            color: white;
            border-color: #6D8A96;
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(109, 138, 150, 0.2);
        }

        .next-button:active {
            transform: scale(0.97);
            box-shadow: none;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(40, 40, 40, 0.6); /* Darker overlay */
            justify-content: center;
            align-items: center;
            opacity: 0;
            animation: fadeInModal 0.4s ease forwards;
        }

        @keyframes fadeInModal {
            from { opacity: 0; }
            to { opacity: 1; }
        }


        .modal-content {
            width: 90%;
            max-width: 650px; /* Slightly wider modal */
            max-height: 85%;
            overflow-y: auto;
            background-color: #FDFBF8; /* Slightly different off-white for modal */
            padding: 30px; /* More padding */
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
            position: relative;
            transform: scale(0.95);
            animation: scaleUpModal 0.4s ease forwards;
        }

         @keyframes scaleUpModal {
            from { transform: scale(0.95); opacity: 0;}
            to { transform: scale(1); opacity: 1;}
         }


        .close {
            position: absolute;
            top: 15px; /* Position adjustment */
            right: 20px;
            font-size: 2rem; /* Larger close icon */
            font-weight: 300; /* Thinner X */
            color: #AAAAAA;
            cursor: pointer;
            line-height: 1;
            transition: color 0.3s ease, transform 0.3s ease;
        }

        .close:hover {
             color: #6D8A96; /* Accent color on hover */
             transform: rotate(90deg); /* Rotate effect */
        }

        .modal-content h2 {
          font-size: 1.5rem; /* Larger modal title */
          margin-bottom: 20px;
          color: #383838;
          font-weight: 600; /* Slightly bolder */
          border-bottom: 1px solid #EAEAEA; /* Separator line */
          padding-bottom: 10px;
        }

        .modal-content p {
          font-size: 1rem;
          line-height: 1.7; /* More line spacing */
          margin-bottom: 15px;
          color: #505050; /* Slightly lighter text */
        }

        .modal-content ol {
            padding-left: 25px; /* Indent list */
            margin-bottom: 16px;
        }

        .modal-content li {
            margin-bottom: 25px; /* More space between list items */
            padding-bottom: 20px;
            border-bottom: 1px solid #EAEAEA;
            list-style-type: decimal; /* Ensure numbers are shown */
        }

         .modal-content li:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

         .modal-content li p {
            margin-bottom: 8px; /* Less space between text within li */
         }
         .modal-content li p strong {
             color: #404040;
         }
         .modal-content li em { /* Style explanation hint */
            color: #777;
         }

        .modal-content img {
            max-width: 150px; /* Smaller image size in list */
            height: auto;
            margin-bottom: 12px; /* Adjusted margin */
            border-radius: 6px; /* Smaller radius */
            border: 1px solid #E0E0E0; /* Consistent border */
            display: block; /* Prevent extra space */
            box-shadow: 0 2px 5px rgba(0,0,0,0.08);
        }

        /* Utility for hiding elements visually but keeping accessible */
        .sr-only {
          position: absolute;
          width: 1px;
          height: 1px;
          padding: 0;
          margin: -1px;
          overflow: hidden;
          clip: rect(0, 0, 0, 0);
          white-space: nowrap;
          border-width: 0;
        }

        /* Hide input area when answer is shown using visibility and opacity */
        .answer-input-container[style*="hidden"],
        .bottom-buttons[style*="hidden"],
        .your-answer-label[style*="hidden"] {
            opacity: 0;
            visibility: hidden;
            transition: visibility 0s linear 0.3s, opacity 0.3s ease;
        }

        @media (prefers-color-scheme: dark) {
    /* --- Dark Theme Variables --- */
    :root {
        --dark-bg-primary: #121212;
        --dark-bg-secondary: #1e1e1e;
        --dark-bg-tertiary: #2a2a2a;
        --dark-text-primary: #e0e0e0;
        --dark-text-secondary: #a0a0a0;
        --dark-text-muted: #757575;
        --dark-border-primary: #383838;
        --dark-border-secondary: #505050;
        --dark-accent-blue: #7aa0b2;
        --dark-accent-blue-hover: #95b9cd;
        --dark-accent-green: #87c7a8;
        --dark-accent-orange: #eaa67a;
        --dark-accent-red: #e08484;
        --dark-shadow-color: rgba(0, 0, 0, 0.5);
        --dark-focus-ring: rgba(122, 160, 178, 0.3);
    }

    /* --- Apply Dark Theme Styles --- */

    html, body {
        background-color: var(--dark-bg-primary);
        color: var(--dark-text-primary);
    }

    /* Titles */
    .flashcard-title, .start-title {
        color: var(--dark-text-primary); /* Light text for title */
    }

    /* Start Screen */
    .start-screen {
        /* Background already covered by body */
    }

    .start-button {
        background-color: var(--dark-accent-blue);
        color: var(--dark-bg-primary); /* Dark text on light button */
        font-weight: 600;
        box-shadow: 0 2px 5px var(--dark-shadow-color);
    }

    .start-button:hover {
        background-color: var(--dark-accent-blue-hover);
        box-shadow: 0 4px 8px var(--dark-shadow-color);
        transform: translateY(-2px);
    }

    .start-button:active {
        background-color: var(--dark-accent-blue);
        transform: translateY(0);
        box-shadow: 0 1px 3px var(--dark-shadow-color);
    }

    /* Footer */
    .footer {
        color: var(--dark-text-muted);
    }

    .footer a {
        color: var(--dark-text-secondary);
    }

    .footer a:hover {
        color: var(--dark-accent-blue-hover);
    }

    /* Game Screen */
    .flashcard-container {
        background-color: var(--dark-bg-primary); /* Match body */
    }

    /* Progress Bar */
    .progress-item {
        color: var(--dark-text-secondary);
        border: 1px solid var(--dark-border-primary);
        background-color: transparent; /* Keep transparent */
    }

    .progress-item:hover {
        background-color: var(--dark-bg-secondary); /* Darker background on hover */
        border-color: var(--dark-border-secondary);
        color: var(--dark-text-primary);
    }

    .progress-number-orange {
        color: var(--dark-accent-orange); /* Use brighter orange */
    }

    .progress-number-green {
        color: var(--dark-accent-green); /* Use brighter green */
    }

    /* Image Area */
    .card-content {
        background-color: var(--dark-bg-secondary); /* Dark background for card */
        box-shadow: 0 4px 15px var(--dark-shadow-color); /* Adjusted shadow */
        border: 1px solid var(--dark-border-primary); /* Darker border */
    }

    /* Loading Spinner */
    .loading-screen {
        background-color: rgba(30, 30, 30, 0.9); /* Semi-transparent dark */
    }

    .spinner {
        border: 4px solid var(--dark-border-primary);
        border-top: 4px solid var(--dark-accent-blue); /* Accent color spinner */
    }

    /* Image styles */
    .card-content img {
        background-color: var(--dark-bg-secondary); /* Ensure bg matches if image is transparent */
        /* Add a subtle filter to slightly desaturate images in dark mode if desired */
        /* filter: brightness(0.95) contrast(0.95); */
    }

    /* Answer Area */
    .your-answer-label {
        color: var(--dark-text-secondary);
    }

    .answer-input {
        background-color: var(--dark-bg-secondary); /* Dark input background */
        color: var(--dark-text-primary); /* Light input text */
        border: 1px solid var(--dark-border-secondary); /* Darker border */
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3) inset; /* Adjusted inner shadow */
    }

    .answer-input::placeholder {
        color: var(--dark-text-muted); /* Lighter placeholder */
    }

    .answer-input:focus {
        border-color: var(--dark-accent-blue); /* Accent color border */
        box-shadow: 0 0 0 3px var(--dark-focus-ring), 0 1px 3px rgba(0, 0, 0, 0.3) inset; /* Focus ring + inner shadow */
    }

    /* Bottom Buttons */
    .dont-know-button {
        color: var(--dark-accent-blue);
        background-color: transparent;
        border: 1px solid transparent;
    }

    .dont-know-button:hover {
        color: var(--dark-accent-blue-hover);
        background-color: rgba(122, 160, 178, 0.15); /* Subtle accent background */
    }

    .answer-button {
        background-color: var(--dark-accent-blue);
        color: var(--dark-bg-primary); /* Dark text */
        font-weight: 600;
        box-shadow: 0 2px 5px var(--dark-shadow-color);
    }

    .answer-button:hover {
        background-color: var(--dark-accent-blue-hover);
        box-shadow: 0 4px 8px var(--dark-shadow-color);
        transform: translateY(-2px);
    }

    .dont-know-button:active, .answer-button:active {
        transform: scale(0.98);
        box-shadow: 0 1px 3px var(--dark-shadow-color);
    }

    /* Answer Display Area */
    .card-answer {
        background-color: rgba(42, 42, 42, 0.9); /* Dark semi-transparent background */
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        color: var(--dark-text-primary); /* Light text */
        box-shadow: 0 5px 20px var(--dark-shadow-color);
        border: 1px solid var(--dark-border-secondary); /* Add subtle border */
    }

    /* Answer feedback colors */
    #showAnswer strong[style*="#10B981"] { color: var(--dark-accent-green) !important; } /* Brighter Green */
    #showAnswer strong[style*="#EF4444"] { color: var(--dark-accent-red) !important; } /* Brighter Red */
    #showAnswer strong[style*="#F59E0B"] { color: var(--dark-accent-orange) !important; } /* Brighter Orange */

    #showExplanation {
        color: var(--dark-text-secondary); /* Lighter explanation text */
    }
    #showExplanation strong {
       color: var(--dark-text-primary); /* Primary text color for 'Explanation:' */
    }

    /* Next Button */
    .next-button {
        background-color: transparent;
        color: var(--dark-accent-blue);
        border: 1px solid var(--dark-accent-blue); /* Accent border */
    }

    .next-button:hover {
        background-color: var(--dark-accent-blue);
        color: var(--dark-bg-primary); /* Dark text on hover */
        border-color: var(--dark-accent-blue);
        box-shadow: 0 2px 6px rgba(122, 160, 178, 0.3);
    }

    .next-button:active {
        transform: scale(0.97);
        box-shadow: none;
    }

    /* Modal styles */
    .modal {
        background-color: rgba(18, 18, 18, 0.75); /* Darker overlay */
    }

    .modal-content {
        background-color: var(--dark-bg-secondary); /* Dark modal background */
        box-shadow: 0 8px 30px var(--dark-shadow-color);
        border: 1px solid var(--dark-border-primary);
    }

    .close {
        color: var(--dark-text-secondary);
    }

    .close:hover {
         color: var(--dark-accent-blue-hover);
         transform: rotate(90deg);
    }

    .modal-content h2 {
      color: var(--dark-text-primary);
      border-bottom: 1px solid var(--dark-border-primary);
    }

    .modal-content p {
      color: var(--dark-text-primary);
    }

    .modal-content ol {
        /* No color changes needed */
    }

    .modal-content li {
       border-bottom: 1px solid var(--dark-border-primary);
    }

    .modal-content li p strong {
        color: var(--dark-text-primary);
    }
    .modal-content li em { /* Style explanation hint */
       color: var(--dark-text-secondary);
    }

    .modal-content img {
        border: 1px solid var(--dark-border-secondary);
        box-shadow: 0 2px 5px var(--dark-shadow-color);
        background-color: var(--dark-bg-tertiary); /* Add subtle background for image */
         /* filter: brightness(0.95) contrast(0.95); */ /* Match filter on main image if applied */
    }

    /* Ensure visibility transitions still work (no changes needed here) */
}
    </style>
</head>
<body onload="init();">

    <!-- Start Screen (Unchanged Logic) -->
    <div class="start-screen">
        <div class="start-title">Parasitology</div>
        <button id="startGame" class="start-button">ÈñãÂßãÂêß</button>
        <div class="footer">
          <a href="https://christmaskid.github.io/parasite_game/" target="_blank">ÂâçÂæÄÂàùÁâà</a> ÔΩú
          <a href="https://line.me/ti/p/~jedieason" target="_blank">ÂïèÈ°åÂõûÂ†±</a> ÔΩú
          <a href="profile.mobileconfig" download="Parasite.mobileconfig">ËòãÊûú‰∏ãËºâ</a>
        </div>
        <!-- Footer removed for cleaner look matching target -->
    </div>

    <!-- Game Screen (Modified Layout) -->  
    <div class="flashcard-container">
        <div class="progress">
            <div class="progress-item" id="wrongArea">
                <span class="progress-number-orange" id="wrong">0</span>
                <span>‰Ω†ÈåØÁöÑ</span> <!-- Changed text to English -->
            </div>
            <div class="progress-item" id="correctArea">
                <span>‰Ω†Â∞çÁöÑ</span> <!-- Changed text to English -->
                <span class="progress-number-green" id="correct">0</span>
            </div>
        </div>

        <!-- Image Content Area -->
        <div class="card-content">
            <div class="loading-screen">
                <div class="spinner"></div>
            </div>
            <!-- Image will be loaded here by JS -->
            <img id="image" onload="this.classList.add('loaded'); document.querySelector('.loading-screen').style.display='none';" src="" alt="Parasite Image">
            <!-- Hidden Answer/Explanation Area (for JS logic) -->
        </div>
        <div class="card-answer">
            <div id="showAnswer"></div>
            <div id="showExplanation"></div>
            <button id="next" class="next-button">‰∏ã‰∏ÄÂÄã</button> <!-- Changed text -->
        </div>
        <!-- Answer Input Area -->
        <div class="your-answer-label">ÈÄôÊòØ‰ªÄÈ∫ºÔºü</div>
        <div class="answer-input-container">
            <input id="answer" type="text" placeholder="ÊääÁ≠îÊ°àÊâìÂú®ÈÄô" class="answer-input">
        </div>

        <!-- Bottom Buttons Area -->
        <div class="bottom-buttons">
            <button id="dontKnow" class="dont-know-button">ÊØçÁÅΩ</button>
            <button id="submitAnswer" class="answer-button">Á¢∫ÂÆö</button>
        </div>

    </div>

    <!-- Modal (Unchanged Logic) -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span id="closeModal" class="close">√ó</span>
            <div id="modalBody">
                <!-- Content will be dynamically injected by JS -->
            </div>
        </div>
    </div>

    <script>
        // --- Original JavaScript (with minor adjustments for new IDs) ---
        var TIME = 31; // Timer duration
        var numOfProbs;
        var tm; // timer (global)
        var data; // answersheet
        var x; // index of current image/question
        var state = 0; // Game state (0: start, 1: answering, 2: showing answer)
        var correct = 0;
        var wrong = 0;
        var total = 0; // Total questions answered in this cycle
        var viewing = false; // Flag to prevent actions while answer is shown
        var done; // Array to track shown questions
        var correctList = []; // List of correctly answered items
        var wrongList = []; // List of incorrectly answered items

        // Function to parse answers that might have multiple options separated by " / "
        function parseMultiAns(data) {
            if (!data) return []; // Handle case where data might be null/undefined
            // Using Object.values might be cleaner if keys aren't important here
            Object.values(data).forEach(item => {
                if (item && typeof item.answer === 'string') {
                    item.answer = item.answer.split(" / ").map(s => s.trim()).filter(s => s); // Split, trim, remove empty
                } else if (!item || typeof item.answer === 'undefined') {
                    // Handle items without an answer property if necessary
                    item.answer = []; // Default to empty array
                }
            });
            return data;
        }

        // Handle Enter key press for submitting answer or moving to next question
        function enterKeyEvent(event) {
            if (event.key === 'Enter') { // Use event.key for modern browsers
                 if (!viewing && document.getElementById("answer").value.trim() !== "") {
                    // If answering and input is not empty, submit answer
                    submitUserAnswer();
                } else if (viewing) {
                    // If viewing answer, proceed to next question
                    nextProb();
                }
            }
        }

        // Initialize the game - load data and set up start screen
        function init() {
            $(document).ready(function () {
                // Use .fail() for better error handling with $.get
                $.get("./answersheet.csv")
                    .done(function (CSVdata) {
                        try {
                            data = $.csv.toObjects(CSVdata);
                            numOfProbs = data.length; // Use length for array
                            if (numOfProbs === 0) throw new Error("No data loaded from CSV.");
                            data = parseMultiAns(data);

                            var btn = document.getElementById("startGame");
                            var startHandler = function () {
                                document.querySelector('.start-screen').style.display = 'none';
                                document.querySelector('.flashcard-container').style.display = 'flex';
                                document.removeEventListener("keypress", enterPressStart); // Remove start listener
                                state = 1; // Set game state to answering
                                done = new Array(numOfProbs).fill(false); // Initialize done array
                                correct = 0;
                                wrong = 0;
                                total = 0;
                                document.getElementById("correct").innerHTML = correct;
                                document.getElementById("wrong").innerHTML = wrong;
                                correctList = [];
                                wrongList = [];
                                startGame(); // Start the main game loop
                            };

                            // Listener for Enter key on start screen
                            var enterPressStart = function (event) {
                                if (event.key === 'Enter') startHandler();
                            };

                            btn.addEventListener("click", startHandler);
                            document.addEventListener("keypress", enterPressStart); // Use keypress for Enter detection initially

                        } catch (error) {
                            console.error("Error processing CSV data:", error);
                            alert("Failed to load or process game data. Please check the console and the CSV file.");
                            // Optionally disable the start button or show an error message on screen
                            document.getElementById("startGame").disabled = true;
                            document.getElementById("startGame").textContent = "Error Loading Data";
                        }
                    })
                    .fail(function (jqXHR, textStatus, errorThrown) {
                        console.error("Failed to load answersheet.csv:", textStatus, errorThrown);
                        alert("Could not load answersheet.csv. Please ensure the file exists and is accessible.");
                        // Disable start button
                         document.getElementById("startGame").disabled = true;
                         document.getElementById("startGame").textContent = "Error Loading Data";
                    });
            });
        }


        // Set up event listeners for the game screen
        function startGame() {
            document.addEventListener("keydown", enterKeyEvent); // Use keydown for Enter key during game
            document.getElementById("submitAnswer").addEventListener("click", submitUserAnswer);
            document.getElementById("dontKnow").addEventListener("click", showAnswer); // "Don't know" button shows the answer
            document.getElementById("next").addEventListener("click", nextProb); // "Next" button in the hidden answer area
            document.getElementById('wrongArea').addEventListener('click', showWrongList);
            document.getElementById('correctArea').addEventListener('click', showCorrectList);
            document.getElementById('closeModal').addEventListener('click', function() {
                document.getElementById('modal').style.display = "none";
            });

            // Close modal if clicking outside the content
            window.onclick = function(event) {
                let modal = document.getElementById('modal');
                if (event.target === modal) {
                    modal.style.display = "none";
                }
            };

             // Shortcut '/' to focus input
            document.addEventListener("keydown", function(e) {
                if (e.key === "/" && document.activeElement !== document.getElementById("answer")) {
                    e.preventDefault();
                    document.getElementById("answer").focus();
                }
            });

            nextProb(); // Load the first question
        }

        // Check if the user's input matches any of the correct answers
        function checkAns(input, ansArr) {
            if (!Array.isArray(ansArr)) return false; // Guard against non-array answers
            const normalizedInput = input.trim().toLowerCase(); // Normalize input
            return ansArr.some(ans => ans.trim().toLowerCase() === normalizedInput); // Case-insensitive check
        }

        // Update correct score and list
        function updateCorrect() {
            correct += 1;
            document.getElementById("correct").innerHTML = correct;
            if (data[x]) correctList.push(data[x]); // Add current item to correct list
            // Optional: Add combo alert or other feedback
             if (correct > 0 && correct % 10 === 0) { // Example: Message every 10 correct
               // console.log(`${correct} correct in a row!`);
             }
        }

        // Update wrong score and list
        function updateWrong() {
            wrong += 1;
            document.getElementById("wrong").innerHTML = wrong;
             if (data[x]) wrongList.push(data[x]); // Add current item to wrong list
        }

        // Function called when user clicks "Answer" button or presses Enter
        function submitUserAnswer() {
            if (viewing) return; // Prevent multiple submissions
            clearTimeout(tm); // Stop the timer

            var userAnswer = document.getElementById("answer").value;
            if (userAnswer.trim() === "") return; // Ignore empty submissions

            viewing = true; // Enter viewing state
            document.querySelector('.answer-input-container').style.visibility = 'hidden'; // Hide input
            document.querySelector('.bottom-buttons').style.visibility = 'hidden'; // Hide buttons
            document.querySelector('.your-answer-label').style.visibility = 'hidden'; // Hide label


            var showAnsDiv = document.getElementById("showAnswer");
            var cardAnswerDiv = document.querySelector(".card-answer");
            cardAnswerDiv.style.display = "flex"; // Show the answer/explanation area

            if (checkAns(userAnswer, data[x].answer)) {
                showAnsDiv.innerHTML = `<strong style="color: #10B981;">Â∞ç‰∫ÜÊ¨∏ÔºÅÔºÅü•π</strong> Á≠îÊ°àÊòØÔºö${data[x].answer.join(' / ')}`;
                hideExplanation(); // Don't show explanation for correct answers unless needed
                updateCorrect();
            } else {
                showAnsDiv.innerHTML = `<strong style="color: #EF4444;">ÈåØ‰∫ÜÈåØ‰∫Üüò≠</strong> Ê≠£Á¢∫Á≠îÊ°àÊòØÔºö${data[x].answer.join(' / ')}`;
                showExplanation(); // Show explanation for wrong answers
                updateWrong();
            }

            total++;
            checkCompletion(); // Check if all questions have been shown
        }

        // Hide the explanation area
        function hideExplanation() {
            document.getElementById("showExplanation").innerHTML = "";
            document.getElementById("showExplanation").style.display = "none";
        }

         // Show the answer (called by "Don't know?" button or timer expiry)
        function showAnswer() {
            if (viewing) return;
            clearTimeout(tm); // Stop the timer

            viewing = true; // Enter viewing state
             document.querySelector('.answer-input-container').style.visibility = 'hidden'; // Hide input
            document.querySelector('.bottom-buttons').style.visibility = 'hidden'; // Hide buttons
             document.querySelector('.your-answer-label').style.visibility = 'hidden'; // Hide label


            var showAnsDiv = document.getElementById("showAnswer");
            var cardAnswerDiv = document.querySelector(".card-answer");
            cardAnswerDiv.style.display = "flex"; // Show the answer/explanation area
            // Position answer overlay above the blank input area

            showAnsDiv.innerHTML = `<strong style="color: #F59E0B;">Á≠îÊ°àÔºö</strong>${data[x].answer.join(' / ')}`;
            showExplanation(); // Show explanation when user didn't know
            updateWrong(); // Count "Don't know" as wrong

            total++;
            checkCompletion(); // Check if all questions have been shown
        }

        // Display the explanation for the current question
        function showExplanation() {
            var expDiv = document.getElementById("showExplanation");
            const explanationText = data[x]?.explanation?.trim(); // Optional chaining and trim
            if (!explanationText || explanationText === "\"\"" || explanationText === "") {
                expDiv.innerHTML = "<i>ÈÄôÈ°åÈÇÑÊ≤íÊúâË©≥Ëß£‚ãØ‰∏çÈÅé‰Ω†ÂèØ‰ª•Ë≤¢Áçª‰∏Ä‰∏ãÔºÅ</i>";
            } else {
                // Basic sanitization: replace potential script tags (more robust needed for untrusted content)
                const sanitizedExplanation = explanationText.replace(/<script.*?>.*?<\/script>/gi, '');
                expDiv.innerHTML = `<strong>ÂÅ∑ÂÅ∑ÂëäË®¥‰Ω†ÁÇ∫‰ªÄÈ∫ºÔºö</strong>${sanitizedExplanation}`;
            }
             expDiv.style.display = "block"; // Ensure it's visible
        }

        // Reset UI and load the next question
        function nextProb() {
            // Hide answer area, show input area
            document.querySelector('.card-answer').style.display = 'none';
             document.querySelector('.answer-input-container').style.visibility = 'visible';
            document.querySelector('.bottom-buttons').style.visibility = 'visible';
             document.querySelector('.your-answer-label').style.visibility = 'visible';

            viewing = false; // Exit viewing state
            resetTime(); // Reset and start timer
            countdown();
            updateImage(); // Load new image
            document.getElementById("answer").value = ""; // Clear input field
            document.getElementById("answer").focus(); // Focus on input field
            document.getElementById("showAnswer").innerHTML = ""; // Clear previous answer text
            document.getElementById("showExplanation").innerHTML = ""; // Clear previous explanation
        }

        // Check if all questions are done and reset if needed
        function checkCompletion() {
             // Check if all 'done' flags are true
             const allDone = done.every(status => status === true);
             if (allDone) {
                 alert("ÊÅ≠Âñú‰Ω†ÂÆåÊàê‰∫ÜÔºÅüéâÈáçÊñ∞ÈñãÂßãÂêßÂòøÂòøÔºÅÔºÅ");
                 // Reset the 'done' array to start over
                 done.fill(false);
                 total = 0; // Reset total count for the new cycle
             }
        }


        // Select a new, unseen image index
        function pickNewImage() {
             // Find indices of questions not yet done
            const availableIndices = [];
            for (let i = 0; i < numOfProbs; i++) {
                if (!done[i]) {
                    availableIndices.push(i);
                }
            }

            if (availableIndices.length === 0) {
                // This case should be handled by checkCompletion, but as a fallback:
                console.warn("All questions shown, restarting cycle.");
                done.fill(false); // Reset all
                // Recalculate available indices (will include all now)
                for (let i = 0; i < numOfProbs; i++) availableIndices.push(i);
                if (availableIndices.length === 0) return -1; // Should not happen if numOfProbs > 0
            }

            // Pick a random index from the available ones
            const randomIndex = Math.floor(Math.random() * availableIndices.length);
            const selectedIndex = availableIndices[randomIndex];

            done[selectedIndex] = true; // Mark as done
            return selectedIndex;
        }

        // Update the image display
        function updateImage() {
            document.querySelector('.loading-screen').style.display = 'flex'; // Show spinner
            var imageElement = document.getElementById("image");
            imageElement.classList.remove('loaded'); // Prepare for new image
            imageElement.src = ""; // Clear previous image src

            x = pickNewImage(); // Get index of the next question
             if (x === -1) { // Handle error case where no image could be picked
                console.error("Could not pick a new image index.");
                // Maybe display an error message or stop the game
                return;
            }

            const picref = data[x]?.path; // Get image path safely

            if (picref) {
                 imageElement.setAttribute('src', picref);
                 // Alt text for accessibility
                 const altText = data[x]?.answer?.[0] || `Parasite image ${x + 1}`;
                 imageElement.setAttribute('alt', `Image for: ${altText}`);
            } else {
                 console.warn(`No image path found for index ${x}.`);
                 // Handle missing image path - maybe show a placeholder or skip?
                 imageElement.alt = "Image not available";
                 // Hide loading spinner immediately if no image src is set
                 document.querySelector('.loading-screen').style.display = 'none';
                 // Consider skipping to the next question automatically or showing text
                 // nextProb(); // Example: skip this question
            }
        }


        // Timer countdown logic
        function countdown() {
            // Timer logic removed as it's not in the target UI
            // If you want to add it back, uncomment the following lines
            // and add a timer display element in the HTML.

            // var show = document.getElementById("timerDisplay"); // Assuming you add <div id="timerDisplay"></div>
            // if (!show) return; // Exit if timer display doesn't exist
            // let currentTime = parseInt(show.innerHTML || TIME, 10);
            // if (currentTime > 0 && !viewing) {
            //     currentTime -= 1;
            //     show.innerHTML = currentTime;
            //     if (currentTime <= 10) show.style.color = "#EF4444"; // Red color for last 10 seconds
            //     tm = window.setTimeout(countdown, 1000);
            // } else if (currentTime === 0 && !viewing) {
            //     showAnswer(); // Time's up, show the answer
            // }
        }

        // Reset timer display and clear timeout
        function resetTime() {
            clearTimeout(tm); // Clear any existing timer
             // Timer logic removed as it's not in the target UI
            // If you add it back, reset its appearance here:
            // var timerDisplay = document.getElementById("timerDisplay");
            // if (timerDisplay) {
            //     timerDisplay.innerHTML = TIME; // Reset display to initial time
            //     timerDisplay.style.color = "#1F2937"; // Reset color
            // }
        }

         // Function to display the list of wrong answers in the modal
        function showWrongList() {
            displayListInModal(wrongList, "‰Ω†Á≠îÈåØÁöÑ");
        }

        // Function to display the list of correct answers in the modal
        function showCorrectList() {
            displayListInModal(correctList, "‰Ω†Á≠îÂ∞çÁöÑ");
        }

        // Helper function to display a list (correct or wrong) in the modal
        function displayListInModal(list, title) {
            let modal = document.getElementById('modal');
            let modalBody = document.getElementById('modalBody');
            let content = `<h2>${title} (${list.length})</h2>`; // Show count in title

            if (list.length === 0) {
                content += `<p>‰Ω†ÈÇÑÊ≤íÊúâ${title === "‰Ω†Á≠îÂ∞çÁöÑ" ?"Á≠îÂ∞çÁöÑ":"Á≠îÈåØÁöÑ"}Ê¨∏‚ãØ</p>`;
            } else {
                content += '<ol>';
                // Use a Set to store displayed image paths to avoid duplicates if needed,
                // or simply iterate through the list as it preserves order.
                for (let item of list) {
                    if (!item) continue; // Skip if item is somehow undefined

                    content += '<li>';
                    // Display image if path exists
                    if (item.path) {
                         // Added width limit for consistency in modal
                        content += `<img src="${item.path}" alt="Image for ${item.answer?.[0] || 'item'}" style="max-width: 200px; margin-bottom: 8px; border-radius: 4px;">`;
                    } else {
                         content += '<p><i>ÔºàÊ≤íË∑ëÂá∫ÂúñÁâáÔºâ</i></p>';
                    }
                    // Display answer(s)
                    const answerText = Array.isArray(item.answer) ? item.answer.join(' / ') : 'N/A';
                    content += `<p><strong>Á≠îÊ°àÔºö</strong>${answerText}</p>`;

                    // Display explanation if it exists and is meaningful
                    const explanationText = item.explanation?.trim();
                     if (explanationText && explanationText !== "\"\"") {
                        const sanitizedExplanation = explanationText.replace(/<script.*?>.*?<\/script>/gi, '');
                        content += `<p style="font-size: 0.9rem; color: #4B5563;"><em>Ëß£ÈáãÔºö</em>${sanitizedExplanation}</p>`;
                    }
                    content += '</li>';
                }
                content += '</ol>';
            }
            modalBody.innerHTML = content;
            modal.style.display = "flex"; // Show the modal
        }

    function adjustPlaceholder() {
        const inputElement = document.getElementById('answer');
        if (!inputElement) return; // Â¶ÇÊûúÂÖÉÁ¥†ÈÇÑÊ≤íËºâÂÖ•ÔºåÂ∞±ÂÖàÈõ¢Èñã

        // Ë®≠ÂÆö‰∏ÄÂÄãÂØ¨Â∫¶ÈñæÂÄº‰æÜÂà§Êñ∑ÊòØÂê¶ÁÇ∫„ÄåÈõªËÖ¶Ëû¢Âπï„Äç (‰æãÂ¶Ç 1024px)
        const desktopBreakpoint = 1024;

        if (window.innerWidth >= desktopBreakpoint) {
            inputElement.placeholder = 'ÊääÁ≠îÊ°àÊâìÂú®ÈÄôÔºå‰Ω†ÂèØ‰ª•ÂÅ∑ÊåâÊåâÁúã / ÁúãÁúã';
        }
    }

    // Âú®È†ÅÈù¢ËºâÂÖ•ÊôÇÂü∑Ë°å‰∏ÄÊ¨°
    adjustPlaceholder();

    // (ÈÅ∏ÊìáÊÄß) Âú®Ë¶ñÁ™óÂ§ßÂ∞èÊîπËÆäÊôÇ‰πüÈáçÊñ∞Âü∑Ë°åÔºå‰ª•Á¢∫‰øùÈüøÊáâÂºè
    window.addEventListener('resize', adjustPlaceholder);

    </script>
</body>
</html>
